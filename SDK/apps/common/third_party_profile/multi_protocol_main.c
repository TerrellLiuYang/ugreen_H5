#include "system/includes.h"
#include "clock_manager/clock_manager.h"
#include "multi_protocol_main.h"
#include "bt_tws.h"

#if (BT_AI_SEL_PROTOCOL & (RCSP_MODE_EN | GFPS_EN))

#define ATT_LOCAL_PAYLOAD_SIZE    (247)//(517)              //note: need >= 20
#define ATT_SEND_CBUF_SIZE        (512*2)                   //note: need >= 20,缓存大小，可修改
#define ATT_RAM_BUFSIZE           (ATT_CTRL_BLOCK_SIZE + ATT_LOCAL_PAYLOAD_SIZE + ATT_SEND_CBUF_SIZE)                   //note:
static u8 att_ram_buffer[ATT_RAM_BUFSIZE] __attribute__((aligned(4)));

#if 0
static const uint8_t multi_profile_data[] = {
    //////////////////////////////////////////////////////
    //
    // 0x0001 PRIMARY_SERVICE  1800
    //
    //////////////////////////////////////////////////////
    0x0a, 0x00, 0x02, 0x00, 0x01, 0x00, 0x00, 0x28, 0x00, 0x18,

    /* CHARACTERISTIC,  2a00, READ | WRITE | DYNAMIC, */
    // 0x0002 CHARACTERISTIC 2a00 READ | WRITE | DYNAMIC
    0x0d, 0x00, 0x02, 0x00, 0x02, 0x00, 0x03, 0x28, 0x0a, 0x03, 0x00, 0x00, 0x2a,
    // 0x0003 VALUE 2a00 READ | WRITE | DYNAMIC
    0x08, 0x00, 0x0a, 0x01, 0x03, 0x00, 0x00, 0x2a,

#if (BT_AI_SEL_PROTOCOL & (RCSP_MODE_EN))

    //////////////////////////////////////////////////////
    //
    // 0x0004 PRIMARY_SERVICE  ae00
    //
    //////////////////////////////////////////////////////
    0x0a, 0x00, 0x02, 0x00, 0x04, 0x00, 0x00, 0x28, 0x00, 0xae,

    /* CHARACTERISTIC,  ae01, WRITE_WITHOUT_RESPONSE | DYNAMIC, */
    // 0x0005 CHARACTERISTIC ae01 WRITE_WITHOUT_RESPONSE | DYNAMIC
    0x0d, 0x00, 0x02, 0x00, 0x05, 0x00, 0x03, 0x28, 0x04, 0x06, 0x00, 0x01, 0xae,
    // 0x0006 VALUE ae01 WRITE_WITHOUT_RESPONSE | DYNAMIC
    0x08, 0x00, 0x04, 0x01, 0x06, 0x00, 0x01, 0xae,

    /* CHARACTERISTIC,  ae02, NOTIFY, */
    // 0x0007 CHARACTERISTIC ae02 NOTIFY
    0x0d, 0x00, 0x02, 0x00, 0x07, 0x00, 0x03, 0x28, 0x10, 0x08, 0x00, 0x02, 0xae,
    // 0x0008 VALUE ae02 NOTIFY
    0x08, 0x00, 0x10, 0x00, 0x08, 0x00, 0x02, 0xae,
    // 0x0009 CLIENT_CHARACTERISTIC_CONFIGURATION
    0x0a, 0x00, 0x0a, 0x01, 0x09, 0x00, 0x02, 0x29, 0x00, 0x00,
#endif

#if (BT_AI_SEL_PROTOCOL & GFPS_EN)
    //////////////////////////////////////////////////////
    //
    // 0x000a PRIMARY_SERVICE  FE2C
    //
    //////////////////////////////////////////////////////
    0x0a, 0x00, 0x02, 0x00, 0x0a, 0x00, 0x00, 0x28, 0x2c, 0xfe,

    /* CHARACTERISTIC,  FE2C1233-8366-4814-8EB0-01DE32100BEA, READ, */
    // 0x000b CHARACTERISTIC FE2C1233-8366-4814-8EB0-01DE32100BEA READ
    0x1b, 0x00, 0x02, 0x00, 0x0b, 0x00, 0x03, 0x28, 0x02, 0x0c, 0x00, 0xea, 0x0b, 0x10, 0x32, 0xde, 0x01, 0xb0, 0x8e, 0x14, 0x48, 0x66, 0x83, 0x33, 0x12, 0x2c, 0xfe,
    // 0x000c VALUE FE2C1233-8366-4814-8EB0-01DE32100BEA READ
    0x16, 0x00, 0x02, 0x02, 0x0c, 0x00, 0xea, 0x0b, 0x10, 0x32, 0xde, 0x01, 0xb0, 0x8e, 0x14, 0x48, 0x66, 0x83, 0x33, 0x12, 0x2c, 0xfe,

    /* CHARACTERISTIC,  FE2C1234-8366-4814-8EB0-01DE32100BEA, NOTIFY | WRITE | DYNAMIC, */
    // 0x000d CHARACTERISTIC FE2C1234-8366-4814-8EB0-01DE32100BEA NOTIFY | WRITE | DYNAMIC
    0x1b, 0x00, 0x02, 0x00, 0x0d, 0x00, 0x03, 0x28, 0x18, 0x0e, 0x00, 0xea, 0x0b, 0x10, 0x32, 0xde, 0x01, 0xb0, 0x8e, 0x14, 0x48, 0x66, 0x83, 0x34, 0x12, 0x2c, 0xfe,
    // 0x000e VALUE FE2C1234-8366-4814-8EB0-01DE32100BEA NOTIFY | WRITE | DYNAMIC
    0x16, 0x00, 0x18, 0x03, 0x0e, 0x00, 0xea, 0x0b, 0x10, 0x32, 0xde, 0x01, 0xb0, 0x8e, 0x14, 0x48, 0x66, 0x83, 0x34, 0x12, 0x2c, 0xfe,
    // 0x000f CLIENT_CHARACTERISTIC_CONFIGURATION
    0x0a, 0x00, 0x0a, 0x01, 0x0f, 0x00, 0x02, 0x29, 0x00, 0x00,

    /* CHARACTERISTIC,  FE2C1235-8366-4814-8EB0-01DE32100BEA, NOTIFY | WRITE | DYNAMIC, */
    // 0x0010 CHARACTERISTIC FE2C1235-8366-4814-8EB0-01DE32100BEA NOTIFY | WRITE | DYNAMIC
    0x1b, 0x00, 0x02, 0x00, 0x10, 0x00, 0x03, 0x28, 0x18, 0x11, 0x00, 0xea, 0x0b, 0x10, 0x32, 0xde, 0x01, 0xb0, 0x8e, 0x14, 0x48, 0x66, 0x83, 0x35, 0x12, 0x2c, 0xfe,
    // 0x0011 VALUE FE2C1235-8366-4814-8EB0-01DE32100BEA NOTIFY | WRITE | DYNAMIC
    0x16, 0x00, 0x18, 0x03, 0x11, 0x00, 0xea, 0x0b, 0x10, 0x32, 0xde, 0x01, 0xb0, 0x8e, 0x14, 0x48, 0x66, 0x83, 0x35, 0x12, 0x2c, 0xfe,
    // 0x0012 CLIENT_CHARACTERISTIC_CONFIGURATION
    0x0a, 0x00, 0x0a, 0x01, 0x12, 0x00, 0x02, 0x29, 0x00, 0x00,

    /* CHARACTERISTIC,  FE2C1236-8366-4814-8EB0-01DE32100BEA, WRITE | DYNAMIC, */
    // 0x0013 CHARACTERISTIC FE2C1236-8366-4814-8EB0-01DE32100BEA WRITE | DYNAMIC
    0x1b, 0x00, 0x02, 0x00, 0x13, 0x00, 0x03, 0x28, 0x08, 0x14, 0x00, 0xea, 0x0b, 0x10, 0x32, 0xde, 0x01, 0xb0, 0x8e, 0x14, 0x48, 0x66, 0x83, 0x36, 0x12, 0x2c, 0xfe,
    // 0x0014 VALUE FE2C1236-8366-4814-8EB0-01DE32100BEA WRITE | DYNAMIC
    0x16, 0x00, 0x08, 0x03, 0x14, 0x00, 0xea, 0x0b, 0x10, 0x32, 0xde, 0x01, 0xb0, 0x8e, 0x14, 0x48, 0x66, 0x83, 0x36, 0x12, 0x2c, 0xfe,

    /* CHARACTERISTIC,  FE2C1237-8366-4814-8EB0-01DE32100BEA, NOTIFY | WRITE | DYNAMIC, */
    // 0x0015 CHARACTERISTIC FE2C1237-8366-4814-8EB0-01DE32100BEA NOTIFY | WRITE | DYNAMIC
    0x1b, 0x00, 0x02, 0x00, 0x15, 0x00, 0x03, 0x28, 0x18, 0x16, 0x00, 0xea, 0x0b, 0x10, 0x32, 0xde, 0x01, 0xb0, 0x8e, 0x14, 0x48, 0x66, 0x83, 0x37, 0x12, 0x2c, 0xfe,
    // 0x0016 VALUE FE2C1237-8366-4814-8EB0-01DE32100BEA NOTIFY | WRITE | DYNAMIC
    0x16, 0x00, 0x18, 0x03, 0x16, 0x00, 0xea, 0x0b, 0x10, 0x32, 0xde, 0x01, 0xb0, 0x8e, 0x14, 0x48, 0x66, 0x83, 0x37, 0x12, 0x2c, 0xfe,
    // 0x0017 CLIENT_CHARACTERISTIC_CONFIGURATION
    0x0a, 0x00, 0x0a, 0x01, 0x17, 0x00, 0x02, 0x29, 0x00, 0x00,

    /* CHARACTERISTIC,  2A26, READ | DYNAMIC, */
    // 0x0018 CHARACTERISTIC 2A26 READ | DYNAMIC
    0x0d, 0x00, 0x02, 0x00, 0x18, 0x00, 0x03, 0x28, 0x02, 0x19, 0x00, 0x26, 0x2a,
    // 0x0019 VALUE 2A26 READ | DYNAMIC
    0x08, 0x00, 0x02, 0x01, 0x19, 0x00, 0x26, 0x2a,
#endif

    // END
    0x00, 0x00,
};
#else
static const uint8_t multi_profile_data[] = {
    //////////////////////////////////////////////////////
    //
    // 0x0001 PRIMARY_SERVICE  1800
    //
    //////////////////////////////////////////////////////
    0x0a, 0x00, 0x02, 0x00, 0x01, 0x00, 0x00, 0x28, 0x00, 0x18,

     /* CHARACTERISTIC,  2a00, READ | WRITE | DYNAMIC, */
    // 0x0002 CHARACTERISTIC 2a00 READ | WRITE | DYNAMIC 
    0x0d, 0x00, 0x02, 0x00, 0x02, 0x00, 0x03, 0x28, 0x0a, 0x03, 0x00, 0x00, 0x2a,
    // 0x0003 VALUE 2a00 READ | WRITE | DYNAMIC  
    0x08, 0x00, 0x0a, 0x01, 0x03, 0x00, 0x00, 0x2a,

    //////////////////////////////////////////////////////
    //
    // 0x0004 PRIMARY_SERVICE  1801
    //
    //////////////////////////////////////////////////////
    0x0a, 0x00, 0x02, 0x00, 0x04, 0x00, 0x00, 0x28, 0x01, 0x18,

     /* CHARACTERISTIC,  2a05, INDICATE | READ | DYNAMIC, */
    // 0x0005 CHARACTERISTIC 2a05 INDICATE | READ | DYNAMIC 
    0x0d, 0x00, 0x02, 0x00, 0x05, 0x00, 0x03, 0x28, 0x22, 0x06, 0x00, 0x05, 0x2a,
    // 0x0006 VALUE 2a05 INDICATE | READ | DYNAMIC  
    0x08, 0x00, 0x22, 0x01, 0x06, 0x00, 0x05, 0x2a,
    // 0x0007 CLIENT_CHARACTERISTIC_CONFIGURATION 
    0x0a, 0x00, 0x0a, 0x01, 0x07, 0x00, 0x02, 0x29, 0x00, 0x00,

    //////////////////////////////////////////////////////
    //
    // 0x0008 PRIMARY_SERVICE  66666666-6666-6666-6666-666666666666
    //
    //////////////////////////////////////////////////////
    0x18, 0x00, 0x02, 0x00, 0x08, 0x00, 0x00, 0x28, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66,

     /* CHARACTERISTIC, 77777777-7777-7777-7777-777777777777, NOTIFY | WRITE | READ | DYNAMIC */
    // 0x0009 CHARACTERISTIC 77777777-7777-7777-7777-777777777777 NOTIFY | WRITE | READ | DYNAMIC 
    0x1b, 0x00, 0x02, 0x00, 0x09, 0x00, 0x03, 0x28, 0x1a, 0x0a, 0x00, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77,
    // 0x000a VALUE 77777777-7777-7777-7777-777777777777 NOTIFY | WRITE | READ | DYNAMIC  
    0x16, 0x00, 0x1a, 0x03, 0x0a, 0x00, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77,
    // 0x000b CLIENT_CHARACTERISTIC_CONFIGURATION 
    0x0a, 0x00, 0x0a, 0x01, 0x0b, 0x00, 0x02, 0x29, 0x00, 0x00,

    //////////////////////////////////////////////////////
    //
    // 0x000c PRIMARY_SERVICE  ae30
    //
    //////////////////////////////////////////////////////
    0x0a, 0x00, 0x02, 0x00, 0x0c, 0x00, 0x00, 0x28, 0x30, 0xae,

     /* CHARACTERISTIC,  ae01, WRITE_WITHOUT_RESPONSE | DYNAMIC, */
    // 0x000d CHARACTERISTIC ae01 WRITE_WITHOUT_RESPONSE | DYNAMIC 
    0x0d, 0x00, 0x02, 0x00, 0x0d, 0x00, 0x03, 0x28, 0x04, 0x0e, 0x00, 0x01, 0xae,
    // 0x000e VALUE ae01 WRITE_WITHOUT_RESPONSE | DYNAMIC  
    0x08, 0x00, 0x04, 0x01, 0x0e, 0x00, 0x01, 0xae,

     /* CHARACTERISTIC,  ae02, NOTIFY, */
    // 0x000f CHARACTERISTIC ae02 NOTIFY 
    0x0d, 0x00, 0x02, 0x00, 0x0f, 0x00, 0x03, 0x28, 0x10, 0x10, 0x00, 0x02, 0xae,
    // 0x0010 VALUE ae02 NOTIFY  
    0x08, 0x00, 0x10, 0x00, 0x10, 0x00, 0x02, 0xae,
    // 0x0011 CLIENT_CHARACTERISTIC_CONFIGURATION 
    0x0a, 0x00, 0x0a, 0x01, 0x11, 0x00, 0x02, 0x29, 0x00, 0x00,

     /* CHARACTERISTIC,  ae03, WRITE_WITHOUT_RESPONSE | DYNAMIC, */
    // 0x0012 CHARACTERISTIC ae03 WRITE_WITHOUT_RESPONSE | DYNAMIC 
    0x0d, 0x00, 0x02, 0x00, 0x12, 0x00, 0x03, 0x28, 0x04, 0x13, 0x00, 0x03, 0xae,
    // 0x0013 VALUE ae03 WRITE_WITHOUT_RESPONSE | DYNAMIC  
    0x08, 0x00, 0x04, 0x01, 0x13, 0x00, 0x03, 0xae,

     /* CHARACTERISTIC,  ae04, NOTIFY, */
    // 0x0014 CHARACTERISTIC ae04 NOTIFY 
    0x0d, 0x00, 0x02, 0x00, 0x14, 0x00, 0x03, 0x28, 0x10, 0x15, 0x00, 0x04, 0xae,
    // 0x0015 VALUE ae04 NOTIFY  
    0x08, 0x00, 0x10, 0x00, 0x15, 0x00, 0x04, 0xae,
    // 0x0016 CLIENT_CHARACTERISTIC_CONFIGURATION 
    0x0a, 0x00, 0x0a, 0x01, 0x16, 0x00, 0x02, 0x29, 0x00, 0x00,

     /* CHARACTERISTIC,  ae05, INDICATE, */
    // 0x0017 CHARACTERISTIC ae05 INDICATE 
    0x0d, 0x00, 0x02, 0x00, 0x17, 0x00, 0x03, 0x28, 0x20, 0x18, 0x00, 0x05, 0xae,
    // 0x0018 VALUE ae05 INDICATE  
    0x08, 0x00, 0x20, 0x00, 0x18, 0x00, 0x05, 0xae,
    // 0x0019 CLIENT_CHARACTERISTIC_CONFIGURATION 
    0x0a, 0x00, 0x0a, 0x01, 0x19, 0x00, 0x02, 0x29, 0x00, 0x00,

     /* CHARACTERISTIC,  ae10, READ | WRITE | DYNAMIC, */
    // 0x001a CHARACTERISTIC ae10 READ | WRITE | DYNAMIC 
    0x0d, 0x00, 0x02, 0x00, 0x1a, 0x00, 0x03, 0x28, 0x0a, 0x1b, 0x00, 0x10, 0xae,
    // 0x001b VALUE ae10 READ | WRITE | DYNAMIC  
    0x08, 0x00, 0x0a, 0x01, 0x1b, 0x00, 0x10, 0xae,


    //////////////////////////////////////////////////////
    //
    // 0x0040 PRIMARY_SERVICE  ae3a
    //
    //////////////////////////////////////////////////////
    0x0a, 0x00, 0x02, 0x00, 0x40, 0x00, 0x00, 0x28, 0x3a, 0xae,

     /* CHARACTERISTIC,  ae3b, WRITE_WITHOUT_RESPONSE | DYNAMIC, */
    // 0x0041 CHARACTERISTIC ae3b WRITE_WITHOUT_RESPONSE | DYNAMIC 
    0x0d, 0x00, 0x02, 0x00, 0x41, 0x00, 0x03, 0x28, 0x04, 0x42, 0x00, 0x3b, 0xae,
    // 0x0042 VALUE ae3b WRITE_WITHOUT_RESPONSE | DYNAMIC  
    0x08, 0x00, 0x04, 0x01, 0x42, 0x00, 0x3b, 0xae,

     /* CHARACTERISTIC,  ae3c, NOTIFY, */
    // 0x0043 CHARACTERISTIC ae3c NOTIFY 
    0x0d, 0x00, 0x02, 0x00, 0x43, 0x00, 0x03, 0x28, 0x10, 0x44, 0x00, 0x3c, 0xae,
    // 0x0044 VALUE ae3c NOTIFY  
    0x08, 0x00, 0x10, 0x00, 0x44, 0x00, 0x3c, 0xae,
    // 0x0045 CLIENT_CHARACTERISTIC_CONFIGURATION 
    0x0a, 0x00, 0x0a, 0x01, 0x45, 0x00, 0x02, 0x29, 0x00, 0x00,


    //////////////////////////////////////////////////////
    //
    // 0x0080 PRIMARY_SERVICE  ae00
    //
    //////////////////////////////////////////////////////
    0x0a, 0x00, 0x02, 0x00, 0x80, 0x00, 0x00, 0x28, 0x00, 0xae,

     /* CHARACTERISTIC,  ae01, WRITE_WITHOUT_RESPONSE | DYNAMIC, */
    // 0x0081 CHARACTERISTIC ae01 WRITE_WITHOUT_RESPONSE | DYNAMIC 
    0x0d, 0x00, 0x02, 0x00, 0x81, 0x00, 0x03, 0x28, 0x04, 0x82, 0x00, 0x01, 0xae,
    // 0x0082 VALUE ae01 WRITE_WITHOUT_RESPONSE | DYNAMIC  
    0x08, 0x00, 0x04, 0x01, 0x82, 0x00, 0x01, 0xae,

     /* CHARACTERISTIC,  ae02, NOTIFY, */
    // 0x0083 CHARACTERISTIC ae02 NOTIFY 
    0x0d, 0x00, 0x02, 0x00, 0x83, 0x00, 0x03, 0x28, 0x10, 0x84, 0x00, 0x02, 0xae,
    // 0x0084 VALUE ae02 NOTIFY  
    0x08, 0x00, 0x10, 0x00, 0x84, 0x00, 0x02, 0xae,
    // 0x0085 CLIENT_CHARACTERISTIC_CONFIGURATION 
    0x0a, 0x00, 0x0a, 0x01, 0x85, 0x00, 0x02, 0x29, 0x00, 0x00,

    // END
    0x00, 0x00, 
}; 
#endif

typedef struct {
    // linked list - assert: first field
    void *offset_item;
    // data is contained in same memory
    u32        service_record_handle;
    u8         *service_record;
} sdp_protocal_item_t;
#define SDP_RECORD_REGISTER(handler) \
	const sdp_protocal_item_t  handler sec(.sdp_record_item)

#if (BT_AI_SEL_PROTOCOL & RCSP_MODE_EN)
extern void rcsp_ble_profile_init(void);
extern void rcsp_bt_ble_init(void);
extern void rcsp_bt_ble_exit(void);
extern void rcsp_bt_ble_adv_enable(u8 enable);
#endif

#if (BT_AI_SEL_PROTOCOL & GFPS_EN)

extern void *gfps_app_ble_hdl;

extern int gfps_all_init(void);
extern void gfps_ble_profile_init(void);
extern void gfps_bt_ble_init(void);
extern void gfps_bt_ble_exit(void);
extern void gfps_bt_ble_adv_enable(u8 enable);
extern void gfps_set_model_id(uint8_t *model_id);
extern void gfps_set_anti_spoofing_public_key(char *public_key);
extern void gfps_set_anti_spoofing_private_key(char *private_key);
extern void gfps_is_tws_master_callback_register(bool (*handler)(void));
extern int gfps_message_deal_handler(int id, int opcode, u8 *data, u32 len);
extern void gfps_message_callback_register(int (*handler)(int id, int opcode, u8 *data, u32 len));

extern const u8 sdp_gfp_spp_service_data[];
SDP_RECORD_REGISTER(gfps_record_item) = {
    .service_record = (u8 *)sdp_gfp_spp_service_data,
    .service_record_handle = 0x00010039,
};

static uint8_t google_model_id_used[3] = {0xF2, 0x63, 0x8D};
static char google_public_key_used[64] = {
    0x5f, 0x17, 0xf0, 0x5a, 0x22, 0x03, 0xe2, 0xdc, 0x93, 0x1d, 0x5c, 0x00, 0xe8, 0xa4, 0x06, 0x7c,
    0x3c, 0x09, 0xa0, 0xad, 0x91, 0x82, 0x3e, 0x45, 0xda, 0xe7, 0xe5, 0x2f, 0x5e, 0xe9, 0x80, 0x1b,
    0xa6, 0xe2, 0x21, 0x9f, 0x65, 0x85, 0xa8, 0xab, 0x65, 0xf1, 0x47, 0x7e, 0x46, 0x7a, 0xdb, 0xb2,
    0x4b, 0x46, 0x72, 0xb8, 0x35, 0x89, 0x0b, 0x99, 0x57, 0xb7, 0x0e, 0xa9, 0x45, 0xe1, 0x7a, 0xbb
};
static char google_private_key_used[32] = {
    0x86, 0x89, 0x57, 0x30, 0xFB, 0x95, 0x8A, 0x9E, 0x42, 0x57, 0x56, 0x97,
    0x39, 0x54, 0x77, 0xE7, 0x62, 0x44, 0x7A, 0xA1, 0x2B, 0xDF, 0x35, 0xFE,
    0xE9, 0xC5, 0x82, 0x28, 0x1B, 0xD7, 0xF5, 0xBE
};
#endif

bool check_tws_master_role()
{
#if TCFG_USER_TWS_ENABLE
    return (tws_api_get_role() == TWS_ROLE_MASTER);
#endif
    return 1;
}

void ble_profile_init(void)
{
    clock_alloc("m_protocol", 12 * 1000000L);
    le_device_db_init();
    app_ble_sm_init(IO_CAPABILITY_NO_INPUT_NO_OUTPUT, SM_AUTHREQ_MITM_PROTECTION | SM_AUTHREQ_BONDING, 7, 0);
    app_ble_init();
    app_spp_init();
    app_ble_profile_set(multi_profile_data);

    multi_protocol_common_callback_init();

    ble_op_multi_att_send_init(att_ram_buffer, ATT_RAM_BUFSIZE, ATT_LOCAL_PAYLOAD_SIZE);

#if (BT_AI_SEL_PROTOCOL & RCSP_MODE_EN)

    extern void bt_rcsp_interface_init(void);
    bt_rcsp_interface_init();
    rcsp_ble_profile_init();
#endif
#if (BT_AI_SEL_PROTOCOL & GFPS_EN)
    gfps_ble_profile_init();
    gfps_is_tws_master_callback_register(check_tws_master_role);
    gfps_message_callback_register(gfps_message_deal_handler);
#endif
}

void bt_ble_init(void)
{
#if (BT_AI_SEL_PROTOCOL & RCSP_MODE_EN)
    rcsp_bt_ble_init();
#endif

#if (BT_AI_SEL_PROTOCOL & GFPS_EN)
    gfps_set_model_id(google_model_id_used);
    gfps_set_anti_spoofing_public_key((char *)google_public_key_used);
    gfps_set_anti_spoofing_private_key((char *)google_private_key_used);
    /* gfps_bt_ble_init(); */
    gfps_all_init();
#endif
}

void bt_ble_exit(void)
{
#if (BT_AI_SEL_PROTOCOL & RCSP_MODE_EN)
    rcsp_bt_ble_exit();
#endif
#if (BT_AI_SEL_PROTOCOL & GFPS_EN)
    /* gfps_bt_ble_exit(); */
#endif
}

void bt_ble_adv_enable(u8 enable)
{
#if (BT_AI_SEL_PROTOCOL & RCSP_MODE_EN)
    rcsp_bt_ble_adv_enable(enable);
#endif
#if (BT_AI_SEL_PROTOCOL & GFPS_EN)
    gfps_bt_ble_adv_enable(enable);
#endif
}

#endif
